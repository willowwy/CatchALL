1 @@ testCode/CVE-2018-7584_CWE-119_523f230c831d7b33353203fa34aee4e92ac12bba_http_fopen_wrapper.c_NEW.c @@ *php_stream_url_wrap_http_ex @@ 740 @@ ['tmp_line_len'] @@ {wrapper, path, mode, context, ua_zval, tmpzval, ssl_proxy_peer_name, transport_string ,, errstr, rh}
php_stream *php_stream_url_wrap_http_ex(php_stream_wrapper *wrapper,
const char *path, const char *mode, int options, char **opened_path,
php_stream_context *context, int redirect_max, int flags STREAMS_DC TSRMLS_DC) /* location: 114 cross_layer: 1 file: http_fopen_wrapper.c
int use_ssl ; location: 118 cross_layer: 1 file: http_fopen_wrapper.c
int use_proxy = 0 ; location: 119 cross_layer: 1 file: http_fopen_wrapper.c
zval * * ua_zval = NULL , * * tmpzval = NULL , * ssl_proxy_peer_name = NULL ; location: 123 cross_layer: 1 file: http_fopen_wrapper.c
char tmp_line [ 128 ] ; location: 130 cross_layer: 1 file: http_fopen_wrapper.c
char * transport_string , * errstr = NULL ; location: 133 cross_layer: 1 file: http_fopen_wrapper.c
struct timeval timeout ; location: 137 cross_layer: 1 file: http_fopen_wrapper.c
int response_code ; location: 143 cross_layer: 1 file: http_fopen_wrapper.c
tmp_line [ 0 ] = '\0'; location: 145 cross_layer: 1 file: http_fopen_wrapper.c
if ( redirect_max < 1 )  location: 147 cross_layer: 1 file: http_fopen_wrapper.c
resource = php_url_parse ( path ); location: 152 cross_layer: 1 file: http_fopen_wrapper.c
if ( resource == NULL )  location: 153 cross_layer: 1 file: http_fopen_wrapper.c
if ( strncasecmp ( resource -> scheme , "http" , sizeof ( "http" ) ) && strncasecmp ( resource -> scheme , "https" , sizeof ( "https" ) ) )  location: 157 cross_layer: 1 file: http_fopen_wrapper.c
if ( ! context || php_stream_context_get_option ( context , wrapper -> wops -> label , "proxy" , & tmpzval ) == FAILURE || Z_TYPE_PP ( tmpzval ) != IS_STRING || Z_STRLEN_PP ( tmpzval ) <= 0 )  location: 158 cross_layer: 1 file: http_fopen_wrapper.c
use_ssl = 0; location: 167 cross_layer: 1 file: http_fopen_wrapper.c
use_proxy = 1; location: 168 cross_layer: 1 file: http_fopen_wrapper.c
transport_len = Z_STRLEN_PP ( tmpzval ); location: 170 cross_layer: 1 file: http_fopen_wrapper.c
transport_string = estrndup ( Z_STRVAL_PP ( tmpzval ) , Z_STRLEN_PP ( tmpzval ) ); location: 171 cross_layer: 1 file: http_fopen_wrapper.c
if ( strpbrk ( mode , "awx+" ) )  location: 175 cross_layer: 1 file: http_fopen_wrapper.c
use_ssl = resource -> scheme && ( strlen ( resource -> scheme ) > 4 ) && resource -> scheme [ 4 ] == 's'; location: 181 cross_layer: 1 file: http_fopen_wrapper.c
if ( use_ssl && resource -> port == 0 )  location: 183 cross_layer: 1 file: http_fopen_wrapper.c
resource -> port = 443; location: 184 cross_layer: 1 file: http_fopen_wrapper.c
if ( resource -> port == 0 )  location: 185 cross_layer: 1 file: http_fopen_wrapper.c
resource -> port = 80; location: 186 cross_layer: 1 file: http_fopen_wrapper.c
if ( context && php_stream_context_get_option ( context , wrapper -> wops -> label , "proxy" , & tmpzval ) == SUCCESS && Z_TYPE_PP ( tmpzval ) == IS_STRING && Z_STRLEN_PP ( tmpzval ) > 0 )  location: 188 cross_layer: 1 file: http_fopen_wrapper.c
use_proxy = 1; location: 192 cross_layer: 1 file: http_fopen_wrapper.c
transport_len = Z_STRLEN_PP ( tmpzval ); location: 193 cross_layer: 1 file: http_fopen_wrapper.c
transport_string = estrndup ( Z_STRVAL_PP ( tmpzval ) , Z_STRLEN_PP ( tmpzval ) ); location: 194 cross_layer: 1 file: http_fopen_wrapper.c
transport_len = spprintf ( & transport_string , 0 , "%s://%s:%d" , use_ssl ? "ssl" : "tcp" , resource -> host , resource -> port ); location: 196 cross_layer: 1 file: http_fopen_wrapper.c
if ( context && php_stream_context_get_option ( context , wrapper -> wops -> label , "timeout" , & tmpzval ) == SUCCESS )  location: 200 cross_layer: 1 file: http_fopen_wrapper.c
timeout . tv_sec = FG ( default_socket_timeout ); location: 206 cross_layer: 1 file: http_fopen_wrapper.c
timeout . tv_usec = 0; location: 207 cross_layer: 1 file: http_fopen_wrapper.c
stream = php_stream_xport_create ( transport_string , transport_len , options , STREAM_XPORT_CLIENT | STREAM_XPORT_CONNECT , NULL , & timeout , context , & errstr , NULL ); location: 210 cross_layer: 1 file: http_fopen_wrapper.c
if ( stream && use_proxy && use_ssl )  location: 226 cross_layer: 1 file: http_fopen_wrapper.c
smart_str header = { 0 } ; location: 227 cross_layer: 1 file: http_fopen_wrapper.c
if ( php_stream_write ( stream , header . c , header . len ) != header . len )  location: 304 cross_layer: 1 file: http_fopen_wrapper.c
stream = NULL; location: 307 cross_layer: 1 file: http_fopen_wrapper.c
if ( stream )  location: 325 cross_layer: 1 file: http_fopen_wrapper.c
stream = NULL; location: 330 cross_layer: 1 file: http_fopen_wrapper.c
if ( stream == NULL )  location: 335 cross_layer: 1 file: http_fopen_wrapper.c
stream -> flags &= ~ ( PHP_STREAM_FLAG_DETECT_EOL | PHP_STREAM_FLAG_EOL_MAC ); location: 345 cross_layer: 1 file: http_fopen_wrapper.c
zval * * rh ; location: 674 cross_layer: 1 file: http_fopen_wrapper.c
if ( zend_hash_find ( EG ( active_symbol_table ) , "http_response_header" , sizeof ( "http_response_header" ) , ( void * * ) & rh ) != SUCCESS || Z_TYPE_PP ( rh ) != IS_ARRAY )  location: 675 cross_layer: 1 file: http_fopen_wrapper.c
if ( ! php_stream_eof ( stream ) )  location: 683 cross_layer: 1 file: http_fopen_wrapper.c
size_t tmp_line_len ; location: 684 cross_layer: 1 file: http_fopen_wrapper.c
if ( php_stream_get_line ( stream , tmp_line , sizeof ( tmp_line ) - 1 , & tmp_line_len ) != NULL )  location: 687 cross_layer: 1 file: http_fopen_wrapper.c
if ( tmp_line_len > 9 )  location: 690 cross_layer: 1 file: http_fopen_wrapper.c
response_code = atoi ( tmp_line + 9 ); location: 691 cross_layer: 1 file: http_fopen_wrapper.c
response_code = 0; location: 693 cross_layer: 1 file: http_fopen_wrapper.c
if ( response_code >= 100 && response_code < 200 )  location: 706 cross_layer: 1 file: http_fopen_wrapper.c
if ( tmp_line_len > 9 )  location: 714 cross_layer: 1 file: http_fopen_wrapper.c
response_code = atoi ( tmp_line + 9 ); location: 715 cross_layer: 1 file: http_fopen_wrapper.c
response_code = 0; location: 717 cross_layer: 1 file: http_fopen_wrapper.c
if ( response_code >= 200 && response_code < 400 )  location: 723 cross_layer: 1 file: http_fopen_wrapper.c
switch ( response_code )  location: 726 cross_layer: 1 file: http_fopen_wrapper.c
if ( ! tmp_line_len )  location: 733 cross_layer: 1 file: http_fopen_wrapper.c
tmp_line [ 0 ] = '\0'; location: 734 cross_layer: 1 file: http_fopen_wrapper.c
if ( tmp_line_len >= 1 && tmp_line [ tmp_line_len - 1 ] == '\n' )  location: 740 cross_layer: 1 file: http_fopen_wrapper.c
if ( tmp_line_len >= 1 && tmp_line [ tmp_line_len - 1 ] == '\r' )  location: 742 cross_layer: 1 file: http_fopen_wrapper.c
ZVAL_STRINGL ( http_response , tmp_line , tmp_line_len , 1 ); location: 747 cross_layer: 1 file: http_fopen_wrapper.c
------------------------------
2 @@ testCode/CVE-2018-7584_CWE-119_523f230c831d7b33353203fa34aee4e92ac12bba_http_fopen_wrapper.c_NEW.c @@ *php_stream_url_wrap_http_ex @@ 742 @@ ['tmp_line_len'] @@ {wrapper, path, mode, context, ua_zval, tmpzval, ssl_proxy_peer_name, transport_string ,, errstr, rh}
php_stream *php_stream_url_wrap_http_ex(php_stream_wrapper *wrapper,
const char *path, const char *mode, int options, char **opened_path,
php_stream_context *context, int redirect_max, int flags STREAMS_DC TSRMLS_DC) /* location: 114 cross_layer: 1 file: http_fopen_wrapper.c
int use_ssl ; location: 118 cross_layer: 1 file: http_fopen_wrapper.c
int use_proxy = 0 ; location: 119 cross_layer: 1 file: http_fopen_wrapper.c
zval * * ua_zval = NULL , * * tmpzval = NULL , * ssl_proxy_peer_name = NULL ; location: 123 cross_layer: 1 file: http_fopen_wrapper.c
char tmp_line [ 128 ] ; location: 130 cross_layer: 1 file: http_fopen_wrapper.c
char * transport_string , * errstr = NULL ; location: 133 cross_layer: 1 file: http_fopen_wrapper.c
struct timeval timeout ; location: 137 cross_layer: 1 file: http_fopen_wrapper.c
int response_code ; location: 143 cross_layer: 1 file: http_fopen_wrapper.c
tmp_line [ 0 ] = '\0'; location: 145 cross_layer: 1 file: http_fopen_wrapper.c
if ( redirect_max < 1 )  location: 147 cross_layer: 1 file: http_fopen_wrapper.c
resource = php_url_parse ( path ); location: 152 cross_layer: 1 file: http_fopen_wrapper.c
if ( resource == NULL )  location: 153 cross_layer: 1 file: http_fopen_wrapper.c
if ( strncasecmp ( resource -> scheme , "http" , sizeof ( "http" ) ) && strncasecmp ( resource -> scheme , "https" , sizeof ( "https" ) ) )  location: 157 cross_layer: 1 file: http_fopen_wrapper.c
if ( ! context || php_stream_context_get_option ( context , wrapper -> wops -> label , "proxy" , & tmpzval ) == FAILURE || Z_TYPE_PP ( tmpzval ) != IS_STRING || Z_STRLEN_PP ( tmpzval ) <= 0 )  location: 158 cross_layer: 1 file: http_fopen_wrapper.c
use_ssl = 0; location: 167 cross_layer: 1 file: http_fopen_wrapper.c
use_proxy = 1; location: 168 cross_layer: 1 file: http_fopen_wrapper.c
transport_len = Z_STRLEN_PP ( tmpzval ); location: 170 cross_layer: 1 file: http_fopen_wrapper.c
transport_string = estrndup ( Z_STRVAL_PP ( tmpzval ) , Z_STRLEN_PP ( tmpzval ) ); location: 171 cross_layer: 1 file: http_fopen_wrapper.c
if ( strpbrk ( mode , "awx+" ) )  location: 175 cross_layer: 1 file: http_fopen_wrapper.c
use_ssl = resource -> scheme && ( strlen ( resource -> scheme ) > 4 ) && resource -> scheme [ 4 ] == 's'; location: 181 cross_layer: 1 file: http_fopen_wrapper.c
if ( use_ssl && resource -> port == 0 )  location: 183 cross_layer: 1 file: http_fopen_wrapper.c
resource -> port = 443; location: 184 cross_layer: 1 file: http_fopen_wrapper.c
if ( resource -> port == 0 )  location: 185 cross_layer: 1 file: http_fopen_wrapper.c
resource -> port = 80; location: 186 cross_layer: 1 file: http_fopen_wrapper.c
if ( context && php_stream_context_get_option ( context , wrapper -> wops -> label , "proxy" , & tmpzval ) == SUCCESS && Z_TYPE_PP ( tmpzval ) == IS_STRING && Z_STRLEN_PP ( tmpzval ) > 0 )  location: 188 cross_layer: 1 file: http_fopen_wrapper.c
use_proxy = 1; location: 192 cross_layer: 1 file: http_fopen_wrapper.c
transport_len = Z_STRLEN_PP ( tmpzval ); location: 193 cross_layer: 1 file: http_fopen_wrapper.c
transport_string = estrndup ( Z_STRVAL_PP ( tmpzval ) , Z_STRLEN_PP ( tmpzval ) ); location: 194 cross_layer: 1 file: http_fopen_wrapper.c
transport_len = spprintf ( & transport_string , 0 , "%s://%s:%d" , use_ssl ? "ssl" : "tcp" , resource -> host , resource -> port ); location: 196 cross_layer: 1 file: http_fopen_wrapper.c
if ( context && php_stream_context_get_option ( context , wrapper -> wops -> label , "timeout" , & tmpzval ) == SUCCESS )  location: 200 cross_layer: 1 file: http_fopen_wrapper.c
timeout . tv_sec = FG ( default_socket_timeout ); location: 206 cross_layer: 1 file: http_fopen_wrapper.c
timeout . tv_usec = 0; location: 207 cross_layer: 1 file: http_fopen_wrapper.c
stream = php_stream_xport_create ( transport_string , transport_len , options , STREAM_XPORT_CLIENT | STREAM_XPORT_CONNECT , NULL , & timeout , context , & errstr , NULL ); location: 210 cross_layer: 1 file: http_fopen_wrapper.c
if ( stream && use_proxy && use_ssl )  location: 226 cross_layer: 1 file: http_fopen_wrapper.c
smart_str header = { 0 } ; location: 227 cross_layer: 1 file: http_fopen_wrapper.c
if ( php_stream_write ( stream , header . c , header . len ) != header . len )  location: 304 cross_layer: 1 file: http_fopen_wrapper.c
stream = NULL; location: 307 cross_layer: 1 file: http_fopen_wrapper.c
if ( stream )  location: 325 cross_layer: 1 file: http_fopen_wrapper.c
stream = NULL; location: 330 cross_layer: 1 file: http_fopen_wrapper.c
if ( stream == NULL )  location: 335 cross_layer: 1 file: http_fopen_wrapper.c
stream -> flags &= ~ ( PHP_STREAM_FLAG_DETECT_EOL | PHP_STREAM_FLAG_EOL_MAC ); location: 345 cross_layer: 1 file: http_fopen_wrapper.c
zval * * rh ; location: 674 cross_layer: 1 file: http_fopen_wrapper.c
if ( zend_hash_find ( EG ( active_symbol_table ) , "http_response_header" , sizeof ( "http_response_header" ) , ( void * * ) & rh ) != SUCCESS || Z_TYPE_PP ( rh ) != IS_ARRAY )  location: 675 cross_layer: 1 file: http_fopen_wrapper.c
if ( ! php_stream_eof ( stream ) )  location: 683 cross_layer: 1 file: http_fopen_wrapper.c
size_t tmp_line_len ; location: 684 cross_layer: 1 file: http_fopen_wrapper.c
if ( php_stream_get_line ( stream , tmp_line , sizeof ( tmp_line ) - 1 , & tmp_line_len ) != NULL )  location: 687 cross_layer: 1 file: http_fopen_wrapper.c
if ( tmp_line_len > 9 )  location: 690 cross_layer: 1 file: http_fopen_wrapper.c
response_code = atoi ( tmp_line + 9 ); location: 691 cross_layer: 1 file: http_fopen_wrapper.c
response_code = 0; location: 693 cross_layer: 1 file: http_fopen_wrapper.c
if ( response_code >= 100 && response_code < 200 )  location: 706 cross_layer: 1 file: http_fopen_wrapper.c
if ( tmp_line_len > 9 )  location: 714 cross_layer: 1 file: http_fopen_wrapper.c
response_code = atoi ( tmp_line + 9 ); location: 715 cross_layer: 1 file: http_fopen_wrapper.c
response_code = 0; location: 717 cross_layer: 1 file: http_fopen_wrapper.c
if ( response_code >= 200 && response_code < 400 )  location: 723 cross_layer: 1 file: http_fopen_wrapper.c
switch ( response_code )  location: 726 cross_layer: 1 file: http_fopen_wrapper.c
if ( ! tmp_line_len )  location: 733 cross_layer: 1 file: http_fopen_wrapper.c
tmp_line [ 0 ] = '\0'; location: 734 cross_layer: 1 file: http_fopen_wrapper.c
if ( tmp_line_len >= 1 && tmp_line [ tmp_line_len - 1 ] == '\n' )  location: 740 cross_layer: 1 file: http_fopen_wrapper.c
if ( tmp_line_len >= 1 && tmp_line [ tmp_line_len - 1 ] == '\r' )  location: 742 cross_layer: 1 file: http_fopen_wrapper.c
ZVAL_STRINGL ( http_response , tmp_line , tmp_line_len , 1 ); location: 747 cross_layer: 1 file: http_fopen_wrapper.c
------------------------------

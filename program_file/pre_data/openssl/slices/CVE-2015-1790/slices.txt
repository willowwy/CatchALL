1 @@ testCode/CVE-2015-1790_NVD-CWE-Other_59302b600e8d5b77ef144e447bb046fd7ab72686_pk7_doit.c_OLD.c @@ *PKCS7_dataDecode @@ 596 @@ ['p7'] @@ {p7, pkey, in_bio, pcert, evp_cipher, enc_alg, ri, ek, tkey}
BIO *PKCS7_dataDecode(PKCS7 *p7, EVP_PKEY *pkey, BIO *in_bio, X509 *pcert) location: 404 cross_layer: 1 file: pk7_doit.c
int i , j ; location: 406 cross_layer: 1 file: pk7_doit.c
const EVP_CIPHER * evp_cipher = NULL ; location: 411 cross_layer: 1 file: pk7_doit.c
X509_ALGOR * enc_alg = NULL ; location: 413 cross_layer: 1 file: pk7_doit.c
STACK_OF ( X509_ALGOR ) * md_sk = NULL; location: 414 cross_layer: 1 file: pk7_doit.c
STACK_OF ( PKCS7_RECIP_INFO ) * rsk = NULL; location: 415 cross_layer: 1 file: pk7_doit.c
PKCS7_RECIP_INFO * ri = NULL ; location: 416 cross_layer: 1 file: pk7_doit.c
unsigned char * ek = NULL , * tkey = NULL ; location: 417 cross_layer: 1 file: pk7_doit.c
int eklen = 0 , tkeylen = 0 ; location: 418 cross_layer: 1 file: pk7_doit.c
if ( p7 == NULL )  location: 420 cross_layer: 1 file: pk7_doit.c
if ( p7 -> d . ptr == NULL )  location: 425 cross_layer: 1 file: pk7_doit.c
i = OBJ_obj2nid ( p7 -> type ); location: 430 cross_layer: 1 file: pk7_doit.c
p7 -> state = PKCS7_S_HEADER; location: 431 cross_layer: 1 file: pk7_doit.c
switch ( i )  location: 433 cross_layer: 1 file: pk7_doit.c
data_body = PKCS7_get_octet_string ( p7 -> d . sign -> contents ); location: 435 cross_layer: 1 file: pk7_doit.c
if ( ! PKCS7_is_detached ( p7 ) && data_body == NULL )  location: 436 cross_layer: 1 file: pk7_doit.c
md_sk = p7 -> d . sign -> md_algs; location: 441 cross_layer: 1 file: pk7_doit.c
rsk = p7 -> d . signed_and_enveloped -> recipientinfo; location: 444 cross_layer: 1 file: pk7_doit.c
md_sk = p7 -> d . signed_and_enveloped -> md_algs; location: 445 cross_layer: 1 file: pk7_doit.c
enc_alg = p7 -> d . signed_and_enveloped -> enc_data -> algorithm; location: 447 cross_layer: 1 file: pk7_doit.c
evp_cipher = EVP_get_cipherbyobj ( enc_alg -> algorithm ); location: 448 cross_layer: 1 file: pk7_doit.c
if ( evp_cipher == NULL )  location: 449 cross_layer: 1 file: pk7_doit.c
rsk = p7 -> d . enveloped -> recipientinfo; location: 456 cross_layer: 1 file: pk7_doit.c
enc_alg = p7 -> d . enveloped -> enc_data -> algorithm; location: 457 cross_layer: 1 file: pk7_doit.c
evp_cipher = EVP_get_cipherbyobj ( enc_alg -> algorithm ); location: 459 cross_layer: 1 file: pk7_doit.c
if ( evp_cipher == NULL )  location: 460 cross_layer: 1 file: pk7_doit.c
if ( md_sk != NULL )  location: 472 cross_layer: 1 file: pk7_doit.c
for (i = 0; i < sk_X509_ALGOR_num(md_sk); i++) location: 473 cross_layer: 1 file: pk7_doit.c
if ( evp_cipher != NULL )  location: 497 cross_layer: 1 file: pk7_doit.c
if ( ( etmp = BIO_new ( BIO_f_cipher ( ) ) ) == NULL )  location: 498 cross_layer: 1 file: pk7_doit.c
if ( pcert )  location: 513 cross_layer: 1 file: pk7_doit.c
for (i = 0; i < sk_PKCS7_RECIP_INFO_num(rsk); i++) location: 514 cross_layer: 1 file: pk7_doit.c
ri = sk_PKCS7_RECIP_INFO_value ( rsk , i ); location: 515 cross_layer: 1 file: pk7_doit.c
if ( ! pkcs7_cmp_ri ( ri , pcert ) )  location: 516 cross_layer: 1 file: pk7_doit.c
ri = NULL; location: 518 cross_layer: 1 file: pk7_doit.c
if ( ri == NULL )  location: 520 cross_layer: 1 file: pk7_doit.c
if ( pcert == NULL )  location: 528 cross_layer: 1 file: pk7_doit.c
for (i = 0; i < sk_PKCS7_RECIP_INFO_num(rsk); i++) location: 533 cross_layer: 1 file: pk7_doit.c
if ( pkcs7_decrypt_rinfo ( & ek , & eklen , ri , pkey ) < 0 )  location: 542 cross_layer: 1 file: pk7_doit.c
evp_ctx = NULL; location: 547 cross_layer: 1 file: pk7_doit.c
if ( EVP_CipherInit_ex ( evp_ctx , evp_cipher , NULL , NULL , NULL , 0 ) <= 0 )  location: 549 cross_layer: 1 file: pk7_doit.c
if ( EVP_CIPHER_asn1_to_param ( evp_ctx , enc_alg -> parameter ) < 0 )  location: 551 cross_layer: 1 file: pk7_doit.c
tkeylen = EVP_CIPHER_CTX_key_length ( evp_ctx ); location: 554 cross_layer: 1 file: pk7_doit.c
tkey = OPENSSL_malloc ( tkeylen ); location: 555 cross_layer: 1 file: pk7_doit.c
if ( ! tkey )  location: 556 cross_layer: 1 file: pk7_doit.c
if ( EVP_CIPHER_CTX_rand_key ( evp_ctx , tkey ) <= 0 )  location: 558 cross_layer: 1 file: pk7_doit.c
if ( ek == NULL )  location: 560 cross_layer: 1 file: pk7_doit.c
ek = tkey; location: 561 cross_layer: 1 file: pk7_doit.c
eklen = tkeylen; location: 562 cross_layer: 1 file: pk7_doit.c
tkey = NULL; location: 563 cross_layer: 1 file: pk7_doit.c
if ( eklen != EVP_CIPHER_CTX_key_length ( evp_ctx ) )  location: 566 cross_layer: 1 file: pk7_doit.c
if ( ! EVP_CIPHER_CTX_set_key_length ( evp_ctx , eklen ) )  location: 572 cross_layer: 1 file: pk7_doit.c
ek = tkey; location: 575 cross_layer: 1 file: pk7_doit.c
if ( EVP_CipherInit_ex ( evp_ctx , NULL , NULL , ek , NULL , 0 ) <= 0 )  location: 582 cross_layer: 1 file: pk7_doit.c
if ( PKCS7_is_detached ( p7 ) || ( in_bio != NULL ) )  location: 596 cross_layer: 1 file: pk7_doit.c
if ( data_body -> length > 0 )  location: 599 cross_layer: 1 file: pk7_doit.c
bio = BIO_new_mem_buf ( data_body -> data , data_body -> length ); location: 600 cross_layer: 1 file: pk7_doit.c
if ( bio == NULL )  location: 605 cross_layer: 1 file: pk7_doit.c
BIO_push ( out , bio ); location: 608 cross_layer: 1 file: pk7_doit.c
BIO_free_all ( bio ); location: 618 cross_layer: 1 file: pk7_doit.c
------------------------------
